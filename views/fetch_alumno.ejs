<%- include('includes/dropdown_admin.ejs') %>
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">


<section class="section">
    <div class="container">
        <div class="columns">
            <div class="column is-3"></div>
            <div class="column is-6">
                <% if (solicitud_pago == true) { %>
                <h3 class="title is-3">Registrar Solicitud de Pago</h3>
                <% } else if (pago_manual == true) { %>
                <h3 class="title is-3">Registrar Pago Manual</h3>
                <% } %>
            </div>
        </div>
        <form action="/pagos/fetch_registrar_solicitud" method="POST">
            <div class="columns">
                <div class="column is-3"></div>
                <div class="column is-6">
                    <label class="label is-medium" for="buscar">Busca a un alumno:</label>
                    <div class="field">
                        <p class="control has-icons-left">
                            <input name="busca" class="input is-medium" type="text" id="buscar"
                                placeholder="Nombre o Matrícula del Alumno" />
                            <span class="icon is-small is-left">
                                <i class="fa-solid fa-magnifying-glass" style="color: #95404c;"></i>
                            </span>
                        </p>
                    </div>
                </div>
            </div>
            <div class="columns">
                <div class="column is-3"></div>
                <div class="column is-6">
                    <button class="button is-rounded is-medium is-responsive" type="submit"
                        style="font-size: large; margin: 8px 2px;" id="Boton_buscar" disabled>
                        <span>Buscar Alumno</span>
                        <span class="icon is-large">
                            <i class="fa-solid fa-circle-chevron-right" style="color: #ffffff;"></i>
                        </span>
                    </button>
                </div>
                <div class="column is-3"></div>
            </div>
        </form>
    </div>
</section>
<script>
    const buscar_alumno = () => {
        const valor_busqueda = document.getElementById('buscar').value;

        //función que manda la petición asíncrona
        fetch('/pagos/registrar_solicitud/autocomplete/' + valor_busqueda, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        }).then((result) => {
            return result.json(); //Regresa otra promesa
        }).then(async (data) => {
            $("#buscar").autocomplete({
                source: data.alumnos.map(function (alumnos) {
                    return (alumnos.Nombre + ' ' + alumnos.Apellidos + ' ' +
                        alumnos.Matricula);
                }),
                minLength: 3
            })
        }).catch(err => {
            console.log(err);
        });
    };

    const buscar = document.querySelector('#buscar');
    buscar.addEventListener('input', buscar_alumno);
</script>