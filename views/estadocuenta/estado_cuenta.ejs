<%- include('../includes/head.ejs', { 
    username: username, 
    permisos: permisos, 
    rol: rol })
    %>

<style>
    .card {
        border: none !important;
    }
    .solicitdes {
        border: 1px solid #dbdbdb; /* Adjust the border color as needed */
        border-radius: 10px; /* Adjust the border radius as needed */
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .solicitdes .table {
        border-collapse: separate;
        border-spacing: 0;
    }

</style>

<section class="section">
    <div class="columns">
        <div class="column is-one-quarter">
            <div class="card">
                <header class="card-header">
                    <p class="card-header-title is-centered has-background-danger has-text-white is-size-4">
                        Estado de Cuenta
                        <a onclick="downloadPDF('<%= matricula %>')" class="icon is-large">
                            <i class="fa-solid fa-download" style="color: #ffffff;"></i>
                        </a>
                    </p>
                </header>
                <div class="card-content">
                    <div class="content">
                        <div class="columns">
                            <div class="column is-12" id="boxContent">
                                <% if(matricula[0] == '1') { %>
                                    <div class="box has-background-light" style="text-align: center;">
                                        <p>CICLO ESCOLAR</p>
                                        <p class="title is-2"><%= periodo.Nombre %></p>
                                    </div>
                                    <% if(estudianteProfesional.porcBeca !== 0) { %>
                                        <div class="box has-background-light" style="text-align: center;">
                                            <p>PORCENTAJE DE BECA</p>
                                            <p class="title is-2"><%= estudianteProfesional.porcBeca %>%</p>
                                        </div>
                                <% } %>
                                <% } else if (matricula[0] == '8') { %>
                                    <% if (diplomados.length != 0) { %> 
                                        <div class="box has-background-light" style="text-align: center;">
                                            <p class="title is-4"> <%= diplomados[0].nombreDiplomado %></p>
                                        </div>
                                        <div class="columns">
                                            <div class="column is-offset-1">
                                                <strong>
                                                    Fecha Inicio:
                                                </strong>
                                                <%= diplomados[0].fechaInicio %>
                                            </div>
                                            <div class="column">
                                                <strong>
                                                    Fecha Fin:
                                                </strong>
                                                <%= diplomados[0].fechaFin %>
                                            </div>
                                        </div>
                                    <% } else { %>
                                        <div class="box has-background-light" style="text-align: center;">
                                            <p class="title is-4">Cursando Ningún Diplomado</p>
                                        </div>
                                        <div class="columns">
                                            <div class="column is-offset-1">
                                                <strong>
                                                    Fecha Inicio:
                                                </strong>
                                                N/A
                                            </div>
                                            <div class="column">
                                                <strong>
                                                    Fecha Fin:
                                                </strong>
                                                N/A
                                            </div>
                                        </div>
                                    <% } %>
                                <% } %>
                            </div>
                        </div>
                        <div class="columns">
                            <div class="column is-12">
                                <a href="/estado_cuenta/pagar">
                                    <button class="button is-responsive">
                                        <span>
                                            Realizar Pago
                                        </span>
                                        <span class="icon is-large">
                                            <i class="fa-solid fa-circle-chevron-right" style="color: #ffffff;"></i>
                                        </span>
                                    </button>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="column is-three-quarters">
            <div class="card">
                <div class="card-content">
                     <div class="tabs is-centered is-boxed is-fullwidth">
                         <ul>
                             <% if (matricula[0] == '1') { %>
                             <li class="is-active" id="nav_deuda">
                                 <a onclick="deuda()">
                                     <span class="icon is-small"><i class="fa-solid fa-clipboard-list"></i></span>
                                     <span>Colegiatura</span>
                                 </a>
                             </li>
                             <% } %>
                             <% if (matricula[0] == '1') { %>
                                <li id="nav_pagos">
                            <% } else if (matricula[0] == '8') { %>
                                <li id="nav_pagos" class="is-active">
                            <% } %>
                                 <a onclick="pagos()">
                                     <span class="icon is-small"><i class="fa-solid fa-timeline"></i></span>
                                     <span>Historial Pagos</span>
                                 </a>
                             </li>
                             <li id="nav_solicitudes">
                                 <a onclick="extras()">
                                     <span class="icon is-small"><i class="fa-solid fa-list-ul"></i></span>
                                     <span>Solicitudes Pendientes</span>
                                 </a>
                             </li>
                             <li id="nav_pagosExtra">
                                 <a onclick="pagosExtra()">
                                     <span class="icon is-small"><i class="fa-solid fa-clock-rotate-left"></i></span>
                                     <span>Otros Pagos</span>
                                 </a>
                             </li>
                         </ul>
                     </div>
                    <div class="is-hidden" id="solicitudes">
                        <% if (pagosExtra.length > 0) { %>
                            <% let countOtros = 5 %>
                            <% pagosExtra.forEach(pagosExtra => { %>
                                <% if (countOtros % 5 == 0) { %>
                                    <div class="columns">
                                <% } %>
                                <% countOtros++ %>
                                <div class="column">
                                    <div class="table-container solicitdes">
                                        <table class="table is-fullwidth">
                                            <tr>
                                                <td style="padding: 5px 15px">
                                                    <p class="has-text-danger has-text-weight-semibold" style="margin: 5px 0">
                                                        MOTIVO
                                                    </p>
                                                    <p class="has-text-black has-text-weight-bold" style="margin: 5px 0">
                                                        <%= pagosExtra.motivoPago %>
                                                    </p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 5px 15px">
                                                    <p class="has-text-danger has-text-weight-semibold" style="margin: 5px 0">
                                                        MONTO
                                                    </p>
                                                    <p class="has-text-black has-text-weight-bold" style="margin: 5px 0">
                                                        $<%= pagosExtra.montoPagar.toLocaleString('mx', {
                                                                        minimumFractionDigits: 2,
                                                                        maximumFractionDigits: 2
                                                                    }) %>
                                                    </p>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                                <% if (countOtros % 5 == 0) { %>
                                    </div>
                                <% } %>
                            <% }); %>
                            <% if (countOtros % 5 != 0) { %>
                                </div>
                            <% } %>
                        <% } else {%>
                            <div class="box">
                                <p class="has-text-weight-medium has-text-black">
                                    Actualmente no cuentas con solicitudes de pagos pendientes.
                                    Por favor contacta a dirección si quieres pagar un Pago Extra.
                                </p>
                            </div>
                        <% } %>
                    </div>

                    <% if (matricula[0] == '1') { %>
                        <div id="pagos" class="is-hidden">
                    <% } else if (matricula[0] == '8') { %>
                        <div id="pagos">
                    <% } %>
                        <% if(matricula[0] == '1') { %>
                            <% if (pagos.length != 0) { %>
                            <table class="table is-fullwidth is-hoverable">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Monto</th>
                                        <th style="text-align: left;">Fecha</th>
                                        <th style="text-align: left;">Motivo</th>
                                        <th style="text-align: left;">Método</th>
                                        <th style="text-align: left;">Nota</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% pagos.forEach(pagos => { %>
                                    <tr>
                                        <td>
                                            $<%= pagos.montoPagado.toLocaleString('mx', {
                                                        minimumFractionDigits: 2,
                                                        maximumFractionDigits: 2
                                                    }) %>
                                        </td>
                                        <td>
                                            <%= pagos.fechaPago %>
                                        </td>
                                        <td>
                                            <%= pagos.motivo %>
                                        </td>
                                        <td>
                                            <%= pagos.metodoPago %>
                                        </td>
                                        <td>
                                            <%= pagos.nota %>
                                        </td>
                                    </tr>
                                    <% } )%>
                                </tbody>
                            </table>
                            <% } else { %>
                            <div class="box">
                                <p class="has-text-weight-medium has-text-black">
                                    ¡Bienvenido a ViaPago! Para realizar tu pago de Colegiatura, por favor dale
                                    click al botón de Realizar Pago.
                                </p>
                            </div>
                            <% } %>
    
                        <% } else if(matricula[0] == '8') { %>
                            <% if (pagosDiplomado.length != 0) { %>
                            <table class="table is-fullwidth is-hoverable">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Monto</th>
                                        <th style="text-align: left;">Diplomado</th>
                                        <th style="text-align: left;">Fecha</th>
                                        <th style="text-align: left;">Motivo</th>
                                        <th style="text-align: left;">Método</th>
                                        <th style="text-align: left;">Nota</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% pagosDiplomado.forEach(pagos => { %>
                                    <tr>
                                        <td>
                                            $<%= pagos.montoPagado.toLocaleString('mx', {
                                                                minimumFractionDigits: 2,
                                                                maximumFractionDigits: 2
                                                            }) %>
                                        </td>
                                        <td>
                                            <%= pagos.nombreDiplomado %>
                                        </td>
                                        <td>
                                            <%= pagos.fechaPago %>
                                        </td>
                                        <td>
                                            <%= pagos.Motivo %>
                                        </td>
                                        <td>
                                            <%= pagos.metodoPago %>
                                        </td>
                                        <td>
                                            <%= pagos.Nota %>
                                        </td>
                                    </tr>
                                    <% }) %>
                                </tbody>
                            </table>
                            <% } else { %>
                            <div class="box">
                                <p class="has-text-weight-medium has-text-black">
                                    ¡Todavía no haz realizado ningún pago de un diplomado! Para pagar, por
                                    favor dale click al botón de Realizar Pago.
                                </p>
                            </div>
                            <% } %>
                        <% } %>
                    </div>

                    <div class="is-hidden" id="pagosExtra">
                            <% if (pagadosExtra.length != 0) { %>
                            <table class="table is-fullwidth is-hoverable">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Monto</th>
                                        <th style="text-align: left;">Fecha</th>
                                        <th style="text-align: left;">Motivo</th>
                                        <th style="text-align: left;">Método</th>
                                        <th style="text-align: left;">Nota</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% pagadosExtra.forEach(pagadosExtra => { %>
                                    <tr>
                                        <td>
                                            $<%= pagadosExtra.montoPagar.toLocaleString('mx', {
                                                            minimumFractionDigits: 2,
                                                            maximumFractionDigits: 2
                                                        }) %>
                                        </td>
                                        <td>
                                            <%= pagadosExtra.fechaPago %>
                                        </td>
                                        <td>
                                            <%= pagadosExtra.motivoPago %>
                                        </td>
                                        <td>
                                            <%= pagadosExtra.metodoPago %>
                                        </td>
                                        <td>
                                            <%= pagadosExtra.Nota %>
                                        </td>
                                    </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                            <% } else { %>
                            <div class="box">
                                <p class="has-text-weight-medium has-text-black">
                                    ¡Todavía no haz realizado ningún pago de tipo Otros Pagos! Si tienes una solicitud
                                    existente, por favor dale click al botón de Realizar Pago.
                                </p>
                            </div>
                            <% } %>
                        </div>

                    <% if(matricula[0] == '1') { %>
                    <div id="deuda">
                        <% if (deuda.length != 0) { %>
                            <div class="table-container">
                                <table class="table is-fullwidth is-hoverable">
                                    <thead>
                                        <tr>
                                            <th style="text-align: left;">#</th>
                                            <th style="text-align: left;">Pendiente</th>
                                            <th style="text-align: left;">Total</th>
                                            <th style="text-align: left;">Pagado</th>
                                            <th style="text-align: left;">Fecha Límite de Pago</th>
                                            <th style="text-align: left;">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% let currentDate = fechaActual %>
                                        <% for (let count = 0; count < deuda.length; count++) { %>
                                        <tr>
                                            <td>Pago #<%= count + 1 %></td>
                                            <td>$<%= deuda[count].saldoPendiente.toLocaleString('mx', {
                                            minimumFractionDigits: 2,
                                            maximumFractionDigits: 2
                                        }) %></td>
                                            <td>$<%= deuda[count].montoAPagar.toLocaleString('mx', {
                                            minimumFractionDigits: 2,
                                            maximumFractionDigits: 2
                                        }) %></td>
                                            <td>$<%= deuda[count].montoPagado.toLocaleString('mx', {
                                            minimumFractionDigits: 2,
                                            maximumFractionDigits: 2
                                        }) %></td>
                                            <td><%= deuda[count].fechaLimitePago %></td>
                                            <% if (deuda[count].Pagado == 1) { %>
                                                <td>
                                                    <span class="tag is-size-6" style="background-color: #ddf5e5;">
                                                         <span class="icon is-small" style="color: #21c85b">
                                                             <i class="fa-solid fa-circle-check"></i>
                                                         </span>
                                                         <span style="color: #21c85b">
                                                            Pagado
                                                         </span>
                                                    </span>
                                                </td>
                                            <% } else if (moment(deuda[count].fechaLimitePago, 'LL').isAfter(currentDate)) { %>
                                                <td>
                                                    <span class="tag is-size-6" style="background-color: #fdf2cc">
                                                         <span class="icon is-small" style="color: #fec416">
                                                             <i class="fa-solid fa-clock"></i>
                                                         </span>
                                                         <span style="color: #fec416">
                                                            Pendiente
                                                         </span>
                                                    </span>
                                                </td>
                                            <% } else { %>
                                                <td>
                                                    <span class="tag is-size-6" style="background-color: #f6d5d8">
                                                        <span class="icon is-small" style="color: #f83362">
                                                            <i class="fa-solid fa-circle-xmark"></i>
                                                        </span>
                                                       <span style="color: #f83362">
                                                           Atrasado
                                                       </span> 
                                                    </span>
                                                </td>
                                            <% } %>
                                        </tr>
                                        <% } %>
                                    </tbody>
                                </table>
                            </div>
                        <% } else { %>
                        <div class="notification is-danger">
                            <p>
                                Todavía no se crea tu Colegiatura para este periodo.
                                Si estas en la fecha de inscripción, por favor entra a Inscripción para confirmar tu
                                horario y
                                que se creen tus fichas de pago.
                            </p>
                        </div>
                        <% } %>
                    </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
</section>
<script type="text/javascript" src="/js/estado_cuenta.js"></script>
<%- include('../includes/foot.ejs') %>