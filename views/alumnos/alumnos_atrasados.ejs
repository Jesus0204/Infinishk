<%- include('../includes/head.ejs', {
    username: username,
    permisos: permisos,
    rol: rol
}) %>

<style>
    .ct-series-a .ct-area,
    .ct-series-a .ct-slice-pie {
        fill: #910106;
        stroke: #910106;
        fill-opacity: 0.6;
    }

    .ct-series-b .ct-area,
    .ct-series-b .ct-slice-pie {
        fill: #5a6581;
        stroke: #5a6581;
        fill-opacity: 0.9;
    }

    .ct-label {
        font-size: 15px;
        font-weight: bold;
    }
</style>

<section class="section">
    <div class="container">
        <% if (actuales[0].length == 0){ %>
        <div class="columns">
            <div class="column is-7">
                <h3 class="title is-3">Alumnos Atrasados en Pagos</h3>
            </div>
        </div>
        <div class="columns">
            <div class="column is-2"></div>
            <div class="column is-8">
                <div class="notification" style="background-color: #5a6581; color:#ffffff;">
                    Actualmente ningún alumno tiene una colegiatura para el periodo activo. Favor de intentar más tarde.
                </div>
            </div>
        </div>
        <% } else if (pagos_atrasados.length == 0) { %>
        <div class="columns">
            <div class="column is-7">
                <h3 class="title is-3">Alumnos Atrasados en Pagos</h3>
                <div class="notification" style="background-color: rgba(4, 114, 77, 0.7); color:#ffffff;">
                    ¡Ningún alumno tiene un pago atrasado! ¡No hay nada que ver por el momento!
                </div>
            </div>
            <div class="column is-5">
                <div class="ct-chart ct-golden-section ct-slice-pie ct-series-x" id="bar-chart"></div>
            </div>
        </div>
        <p class="is-hidden" id="atrasados"><%=atrasados[0].alumnosAtrasados %></p>
        <p class="is-hidden" id="totales"><%= actuales[0].alumnosTotales %></p>
        <% } else { 
            <% for (let deudas_atrasadas of pagos_atrasados) { %>
        <table class="table is-bordered is-hoverable is-fullwidth">
            <thead>
                <tr>
                    <th colspan="2">
                        <div class="columns is-vcentered">
                            <div class="column is-1" style="padding-left: 4em;">
                                <% let calculo_pagos = 0 %>
                                <% for (let deuda of deudas_atrasadas) { %>
                                <% calculo_pagos += deuda.montoPagado / deuda.montoAPagar; %>
                                <% } %>
                                <%= calculo_pagos.toFixed(2) %>
                            </div>
                            <div class="column is-4 is-offset-1">
                                Nombre: <%= deudas_atrasadas[0].Nombre %>
                                <%= deudas_atrasadas[0].Apellidos %>
                            </div>
                            <div class="column is-3">
                                Matricula: <%= deudas_atrasadas[0].matricula %>
                            </div>
                            <div class="column">
                                <form action="/estado_cuenta" method="GET">
                                    <input type="hidden" name="matricula" id="matricula"
                                        value="<% deudas_atrasadas[0].matricula %>">
                                    <button type="submit" class="button is-rounded is-medium is-responsive"
                                        style="font-size: medium;">
                                        <span>Estado de Cuenta</span>
                                        <span class="icon is-large">
                                            <i class="fa-solid fa-circle-chevron-right" style="color: #ffffff;"></i>
                                        </span>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <% let currentDate = new Date(); %>
                <% let options = { year: 'numeric', month: 'long', day: 'numeric' }; %>
                <% for (let count = 0; count < deudas_atrasadas.length; count = count + 2) { %>
                <% if (count + 1 == deudas_atrasadas.length) { %>
                <tr>
                    <td colspan="2">
                        <div class="columns is-vcentered">
                            <div class="column is-full" style="text-align: center;">
                                <strong>Pago #<%= count + 1 %></strong>
                            </div>
                        </div>
                        <div class="columns is-vcentered">
                            <% if (deudas_atrasadas[count].pagado == 1) { %>
                            <div class="column is-narrow">
                                <i class="fa-solid fa-circle-check fa-2xl" style="color: #17b585;"></i>
                            </div>
                            <% } else if (currentDate < deudas_atrasadas[count].fechaLimitePago) { %>
                            <div class="column is-narrow">
                                <i class="fa-solid fa-clock fa-2xl" style="color: #ffc800;"></i>
                            </div>
                            <% } else {%>
                            <div class="column is-narrow">
                                <i class="fa-solid fa-circle-xmark fa-2xl" style="color: #910106;"></i>
                            </div>
                            <% } %>
                            <div class="column">
                                <strong>Pendiente:</strong>
                                $<%= deudas_atrasadas[count].saldoPendiente.toLocaleString('mx'); %>
                                <br>
                                <strong>Total: </strong>
                                $<%= deudas_atrasadas[count].montoAPagar.toLocaleString('mx') %>
                                <br>
                                <strong>Pagado:</strong>
                                $<%= deudas_atrasadas[count].montoPagado.toLocaleString('mx') %>
                            </div>
                            <div class="column">
                                <strong>Fecha Limite Pago:</strong>
                                <br>
                                <%= deudas_atrasadas[count].fechaLimitePago.toLocaleDateString("es-MX", options) %>
                            </div>
                        </div>
                    </td>
                </tr>
                <% } else {%>
                <tr>
                    <td>
                        <div class="columns is-vcentered">
                            <div class="column is-full" style="text-align: center;">
                                <strong>Pago #<%= count + 1 %></strong>
                            </div>
                        </div>
                        <div class="columns is-vcentered">
                            <% if (deudas_atrasadas[count].pagado == 1) { %>
                            <div class="column is-narrow" style="text-align: center;">
                                <i class="fa-solid fa-circle-check fa-2xl" style="color: #17b585;"></i>
                            </div>
                            <% } else if (currentDate < deudas_atrasadas[count].fechaLimitePago) { %>
                            <div class="column is-narrow" style="text-align: center;">
                                <i class="fa-solid fa-clock fa-2xl" style="color: #ffc800;"></i>
                            </div>
                            <% } else {%>
                            <div class="column is-narrow" style="text-align: center;">
                                <i class="fa-solid fa-circle-xmark fa-2xl" style="color: #910106;"></i>
                            </div>
                            <% } %>
                            <div class="column" style="text-align: center;">
                                <strong>Pendiente:</strong>
                                $<%= deudas_atrasadas[count].saldoPendiente.toLocaleString('mx'); %>
                                <br>
                                <strong>Total: </strong>
                                $<%= deudas_atrasadas[count].montoAPagar.toLocaleString('mx') %>
                                <br>
                                <strong>Pagado:</strong>
                                $<%= deudas_atrasadas[count].montoPagado.toLocaleString('mx') %>
                            </div>
                            <div class="column" style="text-align: center;">
                                <strong>Fecha Limite Pago:</strong>
                                <br>
                                <%= deudas_atrasadas[count].fechaLimitePago.toLocaleDateString("es-MX", options) %>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="columns is-vcentered">
                            <div class="column is-full" style="text-align: center;">
                                <strong>Pago #<%= count + 2 %></strong>
                            </div>
                        </div>
                        <div class="columns is-vcentered">
                            <% if (deudas_atrasadas[count + 1].pagado == 1) { %>
                            <div class="column is-narrow" style="text-align: center;">
                                <i class="fa-solid fa-circle-check fa-2xl" style="color: #17b585;"></i>
                            </div>
                            <% } else if (currentDate < deudas_atrasadas[count + 1].fechaLimitePago) { %>
                            <div class="column is-narrow" style="text-align: center;">
                                <i class="fa-solid fa-clock fa-2xl" style="color: #ffc800;"></i>
                            </div>
                            <% } else {%>
                            <div class="column is-narrow" style="text-align: center;">
                                <i class="fa-solid fa-circle-xmark fa-2xl" style="color: #910106;"></i>
                            </div>
                            <% } %>
                            <div class="column" style="text-align: center;">
                                <strong>Pendiente:</strong>
                                $<%= deudas_atrasadas[count + 1].saldoPendiente.toLocaleString('mx') %>
                                <br>
                                <strong>Total:</strong>
                                $<%= deudas_atrasadas[count + 1].montoAPagar.toLocaleString('mx') %>
                                <br>
                                <strong>Pagado:</strong>
                                $<%= deudas_atrasadas[count + 1].montoPagado.toLocaleString('mx') %>
                            </div>
                            <div class="column" style="text-align: center;">
                                <strong>Fecha Limite Pago:</strong>
                                <br>
                                <%= deudas_atrasadas[count + 1].fechaLimitePago.toLocaleDateString("es-MX", options) %>
                            </div>
                        </div>
                    </td>
                </tr>
                <% } %>
                <% } %>
            </tbody>
        </table>
        <% } %>
        <% } %>
    </div>
</section>
<script type="text/javascript" src="/js/alumnos_atrasados.js"></script>