<%- include('../includes/head.ejs', { username: username, permisos: permisos, rol: rol }) %>
    <script type="text/javascript" src="/js/modal_popup.js"></script>

    <style>
        input:focus {
            border: 2px solid #910106 !important
        }

        input:hover {
            border: 2px solid #5a6581 !important;
        }

        .button:hover {
            background-color: #5a6581 !important;
            border-color: #910106 !important;
        }

        .search-bar {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .table-container {
            position: relative;
        }

        .pagination-container {
            margin-top: 20px;
        }

        .pagination-btn {
            margin: 0 5px;
        }
    </style>

    <body>
        <section class="section">
            <div class="container">
                <div class="columns">
                    <div class="column is-6">
                        <h3 class="title is-3">Configuraci√≥n Usuarios</h3>
                    </div>
                    <% if (contienePermiso(permisos, 'Registrar usuario' )==true) { %>
                        <div class="column is-offset-2">
                            <p class="control">
                                <a class="button is-rounded is-responsive" style="font-size: large;"
                                    href="/configuracion/registrar_usuario">
                                    <span class="icon is-large">
                                        <i class="fa-solid fa-circle-plus"></i>
                                    </span>
                                    <span>
                                        Registrar Usuario
                                    </span>
                                </a>
                            </p>
                        </div>
                        <% } %>
                </div>

                <input type="hidden" name="_csrf" id="_csrf" value="<%= csrfToken %>">

                <div class="tabs is-boxed">
                    <ul>
                        <li class="is-active" id="nav_activos">
                            <a onclick="usuarios_activos()">
                                <span class="icon is-small"><i class="fa-solid fa-users"></i></span>
                                <span>Usuarios Activos</span>
                            </a>
                        </li>
                        <li id="nav_no_activos">
                            <a onclick="usuarios_no_activos()">
                                <span class="icon is-small"><i class="fa-regular fa-users-slash"></i></span>
                                <span>Usuarios No Activos</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <div id="usuarios_activos">
                    <% let count_activos=0 %>
                        <% if (usuariosActivos.length===0) { %>
                            <p>No hay usuarios activos por el momento.</p>
                            <% } else { %>
                                <div class="search-bar">
                                    <input type="text" id="searchActivos" class="search-input"
                                        placeholder="Buscar usuarios activos">
                                </div>
                                <div id="tablaActivos" class="table-container">
                                    <table class="table is-bordered is-hoverable is-fullwidth">
                                        <thead>
                                            <tr>
                                            <tr>
                                                <th>
                                                    <p class="is-size-5"><strong>Nombre: </strong></p>
                                                </th>
                                                <th>
                                                    <p class="is-size-5"><strong>Email: </strong></p>
                                                </th>
                                                <th>
                                                    <p class="is-size-5"><strong>Status: </strong></p>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% for (let usuario of usuariosActivos) { %>
                                                <tr id="pagination-content">
                                                    <td>
                                                        <%= usuario.IDUsuario %>
                                                    </td>
                                                    <td>
                                                        <%= usuario.correoElectronico %>
                                                    </td>
                                                    <td>
                                                        <form method="POST" action="/configuracion/modificar_usuario">
                                                            <input type="hidden" name="_csrf" id="_csrf"
                                                                value="<%= csrfToken %>">
                                                            <input type="hidden" name="IDUsuario"
                                                                value="<%= usuario.IDUsuario %>">
                                                            <input type="hidden" name="statusUsuario" value="off">
                                                            <button type="submit"
                                                                class="button is-danger">Desactivar</button>
                                                        </form>
                                                    </td>
                                                </tr>
                                                <% count_activos++ %>
                                                    <% } %>
                                        </tbody>
                                    </table>
                                    <nav class="pagination is-rounded" role="navigation" aria-label="pagination">
                                        <a class="pagination-previous" id="prev-button">Anterior</a>
                                        <a class="pagination-next" id="next-button">Siguiente</a>
                                        <ul class="pagination-list" id="pagination-list">
                                            <div id="pagination-numbers">
                                            </div>
                                        </ul>
                                    </nav>
                                </div>
                                <% } %>
                </div>

                <div id="usuarios_no_activos" class="is-hidden">
                    <% let count_no_activos=0 %>
                        <% if (usuariosNoActivos.length===0) { %>
                            <p>No hay usuarios no activos por el momento.</p>
                            <% } else { %>
                                <div class="search-bar">
                                    <input type="text" id="searchNoActivos" class="search-input"
                                        placeholder="Buscar usuarios no activos">
                                </div>
                                <div id="tablaNoActivos" class="table-container">
                                    <table class="table is-bordered is-hoverable is-fullwidth">
                                        <thead>
                                            <tr>
                                                <th>
                                                    <p class="is-size-5"><strong>Nombre: </strong></p>
                                                </th>
                                                <th>
                                                    <p class="is-size-5"><strong>Email: </strong></p>
                                                </th>
                                                <th>
                                                    <p class="is-size-5"><strong>Status: </strong></p>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% for (let usuario of usuariosNoActivos) { %>
                                                <tr id="pagination-content-2">
                                                    <td>
                                                        <%= usuario.IDUsuario %>
                                                    </td>
                                                    <td>
                                                        <%= usuario.correoElectronico %>
                                                    </td>
                                                    <td>
                                                        <form method="POST" action="/configuracion/modificar_usuario">
                                                            <input type="hidden" name="_csrf" id="_csrf"
                                                                value="<%= csrfToken %>">
                                                            <input type="hidden" name="IDUsuario"
                                                                value="<%= usuario.IDUsuario %>">
                                                            <input type="hidden" name="statusUsuario" value="on">
                                                            <button type="submit"
                                                                class="button is-success">Activar</button>
                                                        </form>
                                                    </td>
                                                </tr>
                                                <% count_no_activos++ %>
                                                    <% } %>
                                        </tbody>
                                    </table>
                                    <nav class="pagination is-rounded" role="navigation" aria-label="pagination">
                                        <a class="pagination-previous" id="prev-button-2">Anterior</a>
                                        <a class="pagination-next" id="next-button-2">Siguiente</a>
                                        <ul class="pagination-list" id="pagination-list-2">
                                            <div id="pagination-numbers-2">
                        
                                            </div>
                                        </ul>
                                    </nav>
                                </div>
                                <% } %>
                </div>
            </div>
        </section>
        <script type="text/javascript" src="/js/pagination.js"></script>
        <script type="text/javascript" src="/js/pagination2.js"></script>
        <script>
            $(document).ready(function () {
                // Funci√≥n para manejar la b√∫squeda en la tabla de usuarios activos
                $('#searchActivos').on('input', function () {
                    const consulta = $(this).val().toLowerCase();
                    $('#tablaActivos tbody tr').filter(function () {
                        $(this).toggle($(this).text().toLowerCase().indexOf(consulta) > -1);
                    });
                });

                // Funci√≥n para manejar la b√∫squeda en la tabla de usuarios no activos
                $('#searchNoActivos').on('input', function () {
                    const consulta = $(this).val().toLowerCase();
                    $('#tablaNoActivos tbody tr').filter(function () {
                        $(this).toggle($(this).text().toLowerCase().indexOf(consulta) > -1);
                    });
                });
            });

            /* Funciones para alternar entre usuarios activos y no activos */
            function usuarios_activos() {
                const tab_no_activos = document.querySelector('#nav_no_activos');
                const tab_activos = document.querySelector('#nav_activos');

                tab_no_activos.classList.remove('is-active');
                tab_activos.classList.add('is-active');

                const usuarios_no_activos = document.querySelector('#usuarios_no_activos');
                usuarios_no_activos.classList.add('is-hidden');

                const usuarios_activos = document.querySelector('#usuarios_activos');
                usuarios_activos.classList.remove('is-hidden');
            }

            function usuarios_no_activos() {
                const tab_no_activos = document.querySelector('#nav_no_activos');
                const tab_activos = document.querySelector('#nav_activos');

                tab_no_activos.classList.add('is-active');
                tab_activos.classList.remove('is-active');

                const usuarios_no_activos = document.querySelector('#usuarios_no_activos');
                usuarios_no_activos.classList.remove('is-hidden');

                const usuarios_activos = document.querySelector('#usuarios_activos');
                usuarios_activos.classList.add('is-hidden');
            }
        </script>
    </body>

    </html>